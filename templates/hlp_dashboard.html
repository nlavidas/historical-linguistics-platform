<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historical Linguistics Platform - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a365d 0%, #2d3748 100%);
            min-height: 100vh;
        }
        
        .layout {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 260px;
            background: #1a202c;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #2d3748;
            margin-bottom: 20px;
        }
        
        .sidebar-header h1 {
            color: #e2e8f0;
            font-size: 1.2em;
            font-weight: 700;
        }
        
        .sidebar-header .subtitle {
            color: #718096;
            font-size: 0.8em;
            margin-top: 5px;
        }
        
        .nav-section {
            margin-bottom: 20px;
        }
        
        .nav-section-title {
            color: #718096;
            font-size: 0.7em;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 0 20px;
            margin-bottom: 10px;
        }
        
        .nav-item {
            display: block;
            padding: 12px 20px;
            color: #a0aec0;
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: #2d3748;
            color: #e2e8f0;
        }
        
        .nav-item.active {
            background: #2d3748;
            color: #63b3ed;
            border-left-color: #63b3ed;
        }
        
        .nav-item-icon {
            margin-right: 10px;
            width: 20px;
            display: inline-block;
            text-align: center;
        }
        
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 30px;
        }
        
        .page-header {
            margin-bottom: 30px;
        }
        
        .page-header h2 {
            color: #e2e8f0;
            font-size: 1.8em;
            margin-bottom: 10px;
        }
        
        .page-header .breadcrumb {
            color: #718096;
            font-size: 0.9em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #2d3748;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #4a5568;
        }
        
        .stat-card h3 {
            color: #718096;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            color: #e2e8f0;
            font-size: 2em;
            font-weight: 700;
        }
        
        .stat-card .label {
            color: #718096;
            font-size: 0.85em;
            margin-top: 5px;
        }
        
        .stat-card.success .value { color: #48bb78; }
        .stat-card.warning .value { color: #ecc94b; }
        .stat-card.danger .value { color: #fc8181; }
        .stat-card.info .value { color: #63b3ed; }
        
        .card {
            background: #2d3748;
            border-radius: 10px;
            border: 1px solid #4a5568;
            margin-bottom: 20px;
        }
        
        .card-header {
            padding: 15px 20px;
            border-bottom: 1px solid #4a5568;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-header h3 {
            color: #e2e8f0;
            font-size: 1.1em;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .btn-primary {
            background: #4299e1;
            color: white;
        }
        
        .btn-primary:hover {
            background: #3182ce;
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .btn-success:hover {
            background: #38a169;
        }
        
        .btn-danger {
            background: #fc8181;
            color: white;
        }
        
        .btn-danger:hover {
            background: #f56565;
        }
        
        .btn-secondary {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #718096;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            color: #a0aec0;
            font-size: 0.9em;
            margin-bottom: 8px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            background: #1a202c;
            border: 1px solid #4a5568;
            border-radius: 6px;
            color: #e2e8f0;
            font-size: 1em;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #4299e1;
        }
        
        select.form-control {
            cursor: pointer;
        }
        
        textarea.form-control {
            min-height: 120px;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #4a5568;
        }
        
        th {
            background: #1a202c;
            color: #a0aec0;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        td {
            color: #e2e8f0;
        }
        
        tr:hover {
            background: #374151;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .badge-success { background: #276749; color: #9ae6b4; }
        .badge-warning { background: #744210; color: #faf089; }
        .badge-danger { background: #742a2a; color: #feb2b2; }
        .badge-info { background: #2a4365; color: #90cdf4; }
        .badge-secondary { background: #4a5568; color: #e2e8f0; }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.running {
            background: #48bb78;
            animation: pulse 2s infinite;
        }
        
        .status-indicator.stopped { background: #fc8181; }
        .status-indicator.pending { background: #ecc94b; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .log-viewer {
            background: #1a202c;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85em;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #2d3748;
            color: #a0aec0;
        }
        
        .log-entry.success { color: #48bb78; }
        .log-entry.error { color: #fc8181; }
        .log-entry.info { color: #63b3ed; }
        .log-entry .timestamp { color: #718096; margin-right: 10px; }
        
        .alert {
            padding: 15px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .alert-success { background: #276749; color: #9ae6b4; }
        .alert-warning { background: #744210; color: #faf089; }
        .alert-danger { background: #742a2a; color: #feb2b2; }
        .alert-info { background: #2a4365; color: #90cdf4; }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 1200px) {
            .grid-3 { grid-template-columns: 1fr 1fr; }
        }
        
        @media (max-width: 900px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .sidebar { display: none; }
            .main-content { margin-left: 0; }
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #718096;
        }
        
        .empty-state h4 {
            margin-bottom: 10px;
            color: #a0aec0;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #1a202c;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #63b3ed);
            transition: width 0.3s;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: #2d3748;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #4a5568;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            color: #e2e8f0;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #718096;
            font-size: 1.5em;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #4a5568;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .refresh-indicator {
            display: inline-block;
            margin-left: 10px;
            color: #718096;
            font-size: 0.8em;
        }
        
        .refresh-indicator.active {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .credits {
            color: #718096;
            font-size: 0.75em;
            padding: 20px;
            border-top: 1px solid #2d3748;
            margin-top: auto;
        }
    </style>
</head>
<body>
    <div class="layout">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1>HLP Dashboard</h1>
                <div class="subtitle">Historical Linguistics Platform</div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Overview</div>
                <a href="/ui" class="nav-item" data-page="dashboard">
                    <span class="nav-item-icon">&#9632;</span> Dashboard
                </a>
                <a href="/ui/system" class="nav-item" data-page="system">
                    <span class="nav-item-icon">&#9881;</span> System Monitor
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Corpus Management</div>
                <a href="/ui/corpora" class="nav-item" data-page="corpora">
                    <span class="nav-item-icon">&#128218;</span> Corpora
                </a>
                <a href="/ui/ingest" class="nav-item" data-page="ingest">
                    <span class="nav-item-icon">&#128229;</span> Text Ingestion
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Analysis</div>
                <a href="/ui/annotation" class="nav-item" data-page="annotation">
                    <span class="nav-item-icon">&#9998;</span> Annotation
                </a>
                <a href="/ui/valency" class="nav-item" data-page="valency">
                    <span class="nav-item-icon">&#128200;</span> Valency
                </a>
                <a href="/ui/diachronic" class="nav-item" data-page="diachronic">
                    <span class="nav-item-icon">&#128336;</span> Diachronic
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Quality</div>
                <a href="/ui/qa" class="nav-item" data-page="qa">
                    <span class="nav-item-icon">&#10003;</span> QA Tools
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">API</div>
                <a href="/docs" class="nav-item" target="_blank">
                    <span class="nav-item-icon">&#128196;</span> Swagger Docs
                </a>
                <a href="/redoc" class="nav-item" target="_blank">
                    <span class="nav-item-icon">&#128214;</span> ReDoc
                </a>
            </div>
            
            <div class="credits">
                Prof. Nikolaos Lavidas<br>
                NKUA / HFRI
            </div>
        </nav>
        
        <main class="main-content">
            <div id="page-dashboard" class="page-content">
                <div class="page-header">
                    <h2>Dashboard</h2>
                    <div class="breadcrumb">Overview of platform status and activity</div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card success">
                        <h3>API Status</h3>
                        <div class="value" id="api-status">
                            <span class="status-indicator running"></span>Online
                        </div>
                        <div class="label">v1.0.0</div>
                    </div>
                    <div class="stat-card info">
                        <h3>Corpora</h3>
                        <div class="value" id="corpora-count">0</div>
                        <div class="label">Total corpora</div>
                    </div>
                    <div class="stat-card info">
                        <h3>Documents</h3>
                        <div class="value" id="documents-count">0</div>
                        <div class="label">Total documents</div>
                    </div>
                    <div class="stat-card info">
                        <h3>Active Jobs</h3>
                        <div class="value" id="active-jobs">0</div>
                        <div class="label">Running tasks</div>
                    </div>
                </div>
                
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3>Recent Activity</h3>
                            <button class="btn btn-sm btn-secondary" onclick="refreshActivity()">Refresh</button>
                        </div>
                        <div class="card-body">
                            <div class="log-viewer" id="activity-log">
                                <div class="log-entry info">
                                    <span class="timestamp">[--:--:--]</span>
                                    Dashboard loaded
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Quick Actions</h3>
                        </div>
                        <div class="card-body">
                            <div class="btn-group" style="flex-direction: column;">
                                <button class="btn btn-primary" onclick="showModal('create-corpus-modal')">Create New Corpus</button>
                                <button class="btn btn-success" onclick="window.location.href='/ui/annotation'">Start Annotation Job</button>
                                <button class="btn btn-secondary" onclick="window.location.href='/ui/ingest'">Ingest Texts</button>
                                <button class="btn btn-secondary" onclick="window.location.href='/ui/valency'">Extract Valency</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Running Jobs</h3>
                        <span class="refresh-indicator" id="jobs-refresh">&#8635;</span>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Job ID</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th>Progress</th>
                                        <th>Started</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="jobs-table">
                                    <tr>
                                        <td colspan="6" class="empty-state">No active jobs</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="page-corpora" class="page-content" style="display:none;">
                <div class="page-header">
                    <h2>Corpora Management</h2>
                    <div class="breadcrumb">Create, view, and manage linguistic corpora</div>
                </div>
                
                <div class="btn-group" style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="showModal('create-corpus-modal')">Create Corpus</button>
                    <button class="btn btn-secondary" onclick="loadCorpora()">Refresh</button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>All Corpora</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Language</th>
                                        <th>Period</th>
                                        <th>Documents</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="corpora-table">
                                    <tr>
                                        <td colspan="6" class="empty-state">Loading corpora...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="page-annotation" class="page-content" style="display:none;">
                <div class="page-header">
                    <h2>Annotation</h2>
                    <div class="breadcrumb">Annotate texts with multiple AI engines</div>
                </div>
                
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3>Quick Annotate</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>Text to Annotate</label>
                                <textarea class="form-control" id="annotate-text" placeholder="Enter text to annotate..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Language</label>
                                <select class="form-control" id="annotate-language">
                                    <option value="grc">Ancient Greek</option>
                                    <option value="lat">Latin</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Engine</label>
                                <select class="form-control" id="annotate-engine">
                                    <option value="stanza">Stanza</option>
                                    <option value="spacy">spaCy</option>
                                    <option value="ensemble">Ensemble (All)</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="annotateText()">Annotate</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Annotation Result</h3>
                        </div>
                        <div class="card-body">
                            <div id="annotation-result" class="log-viewer">
                                <div class="empty-state">
                                    <h4>No annotation yet</h4>
                                    <p>Enter text and click Annotate to see results</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Create Annotation Job</h3>
                    </div>
                    <div class="card-body">
                        <div class="grid-3">
                            <div class="form-group">
                                <label>Select Corpus</label>
                                <select class="form-control" id="annotation-corpus">
                                    <option value="">-- Select corpus --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Annotation Engine</label>
                                <select class="form-control" id="annotation-job-engine">
                                    <option value="stanza">Stanza</option>
                                    <option value="spacy">spaCy</option>
                                    <option value="huggingface">HuggingFace</option>
                                    <option value="ensemble">Ensemble</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Annotation Levels</label>
                                <select class="form-control" id="annotation-levels" multiple>
                                    <option value="tokenization" selected>Tokenization</option>
                                    <option value="pos" selected>POS Tagging</option>
                                    <option value="morphology" selected>Morphology</option>
                                    <option value="syntax" selected>Syntax</option>
                                    <option value="ner">Named Entities</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-success" onclick="createAnnotationJob()">Create Job</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Annotation Jobs</h3>
                        <button class="btn btn-sm btn-secondary" onclick="loadAnnotationJobs()">Refresh</button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Job ID</th>
                                        <th>Corpus</th>
                                        <th>Engine</th>
                                        <th>Status</th>
                                        <th>Progress</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="annotation-jobs-table">
                                    <tr>
                                        <td colspan="6" class="empty-state">Loading jobs...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="page-valency" class="page-content" style="display:none;">
                <div class="page-header">
                    <h2>Valency Analysis</h2>
                    <div class="breadcrumb">Extract and analyze verb valency patterns</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Extract Valency</h3>
                    </div>
                    <div class="card-body">
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Select Corpus</label>
                                <select class="form-control" id="valency-corpus">
                                    <option value="">-- Select corpus --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Verb Lemma (optional)</label>
                                <input type="text" class="form-control" id="valency-verb" placeholder="e.g., didomi, fero">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="extractValency()">Extract Valency</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Valency Lexicons</h3>
                        <button class="btn btn-sm btn-secondary" onclick="loadLexicons()">Refresh</button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Lexicon</th>
                                        <th>Language</th>
                                        <th>Patterns</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="lexicons-table">
                                    <tr>
                                        <td colspan="5" class="empty-state">Loading lexicons...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Valency Jobs</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Job ID</th>
                                        <th>Corpus</th>
                                        <th>Status</th>
                                        <th>Patterns Found</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="valency-jobs-table">
                                    <tr>
                                        <td colspan="5" class="empty-state">Loading jobs...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="page-ingest" class="page-content" style="display:none;">
                <div class="page-header">
                    <h2>Text Ingestion</h2>
                    <div class="breadcrumb">Collect texts from various sources</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Available Sources</h3>
                        <button class="btn btn-sm btn-secondary" onclick="loadSources()">Refresh</button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Source</th>
                                        <th>Description</th>
                                        <th>Languages</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="sources-table">
                                    <tr>
                                        <td colspan="5" class="empty-state">Loading sources...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Create Ingest Job</h3>
                    </div>
                    <div class="card-body">
                        <div class="grid-3">
                            <div class="form-group">
                                <label>Source</label>
                                <select class="form-control" id="ingest-source">
                                    <option value="perseus">Perseus Digital Library</option>
                                    <option value="first1k_greek">First1KGreek</option>
                                    <option value="gutenberg">Project Gutenberg</option>
                                    <option value="proiel">PROIEL Treebanks</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Language</label>
                                <select class="form-control" id="ingest-language">
                                    <option value="grc">Ancient Greek</option>
                                    <option value="lat">Latin</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Max Texts</label>
                                <input type="number" class="form-control" id="ingest-max" value="10" min="1" max="1000">
                            </div>
                        </div>
                        <button class="btn btn-success" onclick="createIngestJob()">Start Ingestion</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Ingest Jobs</h3>
                        <button class="btn btn-sm btn-secondary" onclick="loadIngestJobs()">Refresh</button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Job ID</th>
                                        <th>Source</th>
                                        <th>Language</th>
                                        <th>Status</th>
                                        <th>Texts</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="ingest-jobs-table">
                                    <tr>
                                        <td colspan="6" class="empty-state">Loading jobs...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="page-diachronic" class="page-content" style="display:none;">
                <div class="page-header">
                    <h2>Diachronic Analysis</h2>
                    <div class="breadcrumb">Track linguistic changes across time periods</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Historical Periods</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Period</th>
                                        <th>Start Year</th>
                                        <th>End Year</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody id="periods-table">
                                    <tr>
                                        <td colspan="4" class="empty-state">Loading periods...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Analyze Diachronic Change</h3>
                    </div>
                    <div class="card-body">
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Feature to Analyze</label>
                                <select class="form-control" id="diachronic-feature">
                                    <option value="case_usage">Case Usage</option>
                                    <option value="word_order">Word Order</option>
                                    <option value="valency_patterns">Valency Patterns</option>
                                    <option value="vocabulary">Vocabulary</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Corpus</label>
                                <select class="form-control" id="diachronic-corpus">
                                    <option value="">-- Select corpus --</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="analyzeDiachronic()">Analyze</button>
                    </div>
                </div>
            </div>
            
            <div id="page-qa" class="page-content" style="display:none;">
                <div class="page-header">
                    <h2>Quality Assurance</h2>
                    <div class="breadcrumb">Validate and audit corpus annotations</div>
                </div>
                
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3>Validate Text</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>Content to Validate</label>
                                <textarea class="form-control" id="validate-content" placeholder="Paste PROIEL XML or CoNLL-U content..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Format</label>
                                <select class="form-control" id="validate-format">
                                    <option value="proiel">PROIEL XML</option>
                                    <option value="conllu">CoNLL-U</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="validateContent()">Validate</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Validation Result</h3>
                        </div>
                        <div class="card-body">
                            <div id="validation-result" class="log-viewer">
                                <div class="empty-state">
                                    <h4>No validation yet</h4>
                                    <p>Enter content and click Validate</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Corpus Audit</h3>
                    </div>
                    <div class="card-body">
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Select Corpus</label>
                                <select class="form-control" id="audit-corpus">
                                    <option value="">-- Select corpus --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Audit Type</label>
                                <select class="form-control" id="audit-type">
                                    <option value="full">Full Audit</option>
                                    <option value="quick">Quick Check</option>
                                    <option value="consistency">Consistency Only</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-success" onclick="startAudit()">Start Audit</button>
                    </div>
                </div>
            </div>
            
            <div id="page-system" class="page-content" style="display:none;">
                <div class="page-header">
                    <h2>System Monitor</h2>
                    <div class="breadcrumb">Monitor platform health and 24/7 scheduler</div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card success">
                        <h3>API Server</h3>
                        <div class="value" id="system-api-status">
                            <span class="status-indicator running"></span>Running
                        </div>
                        <div class="label">Port 8000</div>
                    </div>
                    <div class="stat-card" id="scheduler-card">
                        <h3>24/7 Scheduler</h3>
                        <div class="value" id="scheduler-status">Checking...</div>
                        <div class="label" id="scheduler-label">--</div>
                    </div>
                    <div class="stat-card info">
                        <h3>Database</h3>
                        <div class="value" id="db-status">Connected</div>
                        <div class="label">SQLite</div>
                    </div>
                    <div class="stat-card info">
                        <h3>Uptime</h3>
                        <div class="value" id="uptime">--</div>
                        <div class="label">Since last restart</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>System Information</h3>
                    </div>
                    <div class="card-body">
                        <div id="system-info">
                            <p><strong>API Version:</strong> <span id="api-version">--</span></p>
                            <p><strong>API Title:</strong> <span id="api-title">--</span></p>
                            <p><strong>Endpoints:</strong></p>
                            <ul id="api-endpoints"></ul>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>System Logs</h3>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-secondary" onclick="refreshSystemLogs()">Refresh</button>
                            <button class="btn btn-sm btn-secondary" onclick="clearSystemLogs()">Clear</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="log-viewer" id="system-logs">
                            <div class="log-entry info">
                                <span class="timestamp">[--:--:--]</span>
                                System monitor initialized
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div id="create-corpus-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Corpus</h3>
                <button class="modal-close" onclick="hideModal('create-corpus-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Corpus Name</label>
                    <input type="text" class="form-control" id="corpus-name" placeholder="e.g., Greek NT Corpus">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea class="form-control" id="corpus-description" placeholder="Describe the corpus..."></textarea>
                </div>
                <div class="form-group">
                    <label>Language</label>
                    <select class="form-control" id="corpus-language">
                        <option value="grc">Ancient Greek</option>
                        <option value="lat">Latin</option>
                        <option value="en">English</option>
                        <option value="got">Gothic</option>
                        <option value="chu">Old Church Slavonic</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Period</label>
                    <select class="form-control" id="corpus-period">
                        <option value="classical">Classical</option>
                        <option value="hellenistic">Hellenistic</option>
                        <option value="roman">Roman</option>
                        <option value="late_antique">Late Antique</option>
                        <option value="byzantine">Byzantine</option>
                        <option value="medieval">Medieval</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('create-corpus-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="createCorpus()">Create</button>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = '/api/v1';
        let currentPage = 'dashboard';
        let refreshInterval = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            const page = '{{ page }}' || 'dashboard';
            showPage(page);
            initDashboard();
            
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });
            
            startAutoRefresh();
        });
        
        function showPage(page) {
            document.querySelectorAll('.page-content').forEach(p => p.style.display = 'none');
            document.getElementById('page-' + page).style.display = 'block';
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });
            
            currentPage = page;
            
            switch(page) {
                case 'dashboard': loadDashboardData(); break;
                case 'corpora': loadCorpora(); break;
                case 'annotation': loadAnnotationPage(); break;
                case 'valency': loadValencyPage(); break;
                case 'ingest': loadIngestPage(); break;
                case 'diachronic': loadDiachronicPage(); break;
                case 'qa': loadQAPage(); break;
                case 'system': loadSystemPage(); break;
            }
        }
        
        function initDashboard() {
            loadDashboardData();
        }
        
        async function loadDashboardData() {
            try {
                const health = await fetch('/health').then(r => r.json());
                document.getElementById('api-status').innerHTML = 
                    '<span class="status-indicator running"></span>Online';
                
                const corpora = await fetch(API_BASE + '/corpus/').then(r => r.json());
                document.getElementById('corpora-count').textContent = corpora.length || 0;
                
                let docCount = 0;
                for (const corpus of corpora) {
                    if (corpus.document_count) docCount += corpus.document_count;
                }
                document.getElementById('documents-count').textContent = docCount;
                
                const annotationJobs = await fetch(API_BASE + '/annotation/jobs').then(r => r.json());
                const ingestJobs = await fetch(API_BASE + '/ingest/jobs').then(r => r.json());
                const valencyJobs = await fetch(API_BASE + '/valency/jobs').then(r => r.json());
                
                const activeJobs = [...annotationJobs, ...ingestJobs, ...valencyJobs]
                    .filter(j => j.status === 'running' || j.status === 'pending').length;
                document.getElementById('active-jobs').textContent = activeJobs;
                
                updateJobsTable([...annotationJobs, ...ingestJobs, ...valencyJobs]);
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                addActivityLog('Error loading dashboard data', 'error');
            }
        }
        
        function updateJobsTable(jobs) {
            const tbody = document.getElementById('jobs-table');
            const activeJobs = jobs.filter(j => j.status === 'running' || j.status === 'pending');
            
            if (activeJobs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No active jobs</td></tr>';
                return;
            }
            
            tbody.innerHTML = activeJobs.map(job => `
                <tr>
                    <td>${job.job_id || job.id || '--'}</td>
                    <td>${job.type || 'annotation'}</td>
                    <td><span class="badge badge-${job.status === 'running' ? 'success' : 'warning'}">${job.status}</span></td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${job.progress || 0}%"></div>
                        </div>
                    </td>
                    <td>${job.created_at || '--'}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="cancelJob('${job.job_id || job.id}', '${job.type || 'annotation'}')">Cancel</button>
                    </td>
                </tr>
            `).join('');
        }
        
        async function loadCorpora() {
            try {
                const corpora = await fetch(API_BASE + '/corpus/').then(r => r.json());
                const tbody = document.getElementById('corpora-table');
                
                if (corpora.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No corpora yet. Create one to get started.</td></tr>';
                    return;
                }
                
                tbody.innerHTML = corpora.map(corpus => `
                    <tr>
                        <td>${corpus.name}</td>
                        <td>${corpus.language || '--'}</td>
                        <td>${corpus.period || '--'}</td>
                        <td>${corpus.document_count || 0}</td>
                        <td>${corpus.created_at || '--'}</td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="viewCorpus('${corpus.id}')">View</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCorpus('${corpus.id}')">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading corpora:', error);
            }
        }
        
        async function createCorpus() {
            const name = document.getElementById('corpus-name').value;
            const description = document.getElementById('corpus-description').value;
            const language = document.getElementById('corpus-language').value;
            const period = document.getElementById('corpus-period').value;
            
            if (!name) {
                alert('Please enter a corpus name');
                return;
            }
            
            try {
                const response = await fetch(API_BASE + '/corpus/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description, language, period })
                });
                
                if (response.ok) {
                    hideModal('create-corpus-modal');
                    addActivityLog('Created corpus: ' + name, 'success');
                    loadCorpora();
                    loadDashboardData();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.message || 'Failed to create corpus'));
                }
            } catch (error) {
                console.error('Error creating corpus:', error);
                alert('Error creating corpus');
            }
        }
        
        async function deleteCorpus(id) {
            if (!confirm('Are you sure you want to delete this corpus?')) return;
            
            try {
                await fetch(API_BASE + '/corpus/' + id, { method: 'DELETE' });
                addActivityLog('Deleted corpus: ' + id, 'info');
                loadCorpora();
                loadDashboardData();
            } catch (error) {
                console.error('Error deleting corpus:', error);
            }
        }
        
        async function loadAnnotationPage() {
            await loadCorporaDropdowns();
            await loadAnnotationJobs();
        }
        
        async function loadAnnotationJobs() {
            try {
                const jobs = await fetch(API_BASE + '/annotation/jobs').then(r => r.json());
                const tbody = document.getElementById('annotation-jobs-table');
                
                if (jobs.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No annotation jobs</td></tr>';
                    return;
                }
                
                tbody.innerHTML = jobs.map(job => `
                    <tr>
                        <td>${job.job_id || job.id}</td>
                        <td>${job.corpus_id || '--'}</td>
                        <td>${job.engine || '--'}</td>
                        <td><span class="badge badge-${getStatusBadge(job.status)}">${job.status}</span></td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${job.progress || 0}%"></div>
                            </div>
                        </td>
                        <td>
                            ${job.status === 'running' ? `<button class="btn btn-sm btn-danger" onclick="cancelAnnotationJob('${job.job_id || job.id}')">Cancel</button>` : ''}
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading annotation jobs:', error);
            }
        }
        
        async function annotateText() {
            const text = document.getElementById('annotate-text').value;
            const language = document.getElementById('annotate-language').value;
            const engine = document.getElementById('annotate-engine').value;
            
            if (!text) {
                alert('Please enter text to annotate');
                return;
            }
            
            const resultDiv = document.getElementById('annotation-result');
            resultDiv.innerHTML = '<div class="log-entry info">Annotating...</div>';
            
            try {
                const response = await fetch(API_BASE + '/annotation/annotate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, language, engine })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = '<pre style="color: #e2e8f0; white-space: pre-wrap;">' + 
                        JSON.stringify(result, null, 2) + '</pre>';
                    addActivityLog('Annotated text with ' + engine, 'success');
                } else {
                    resultDiv.innerHTML = '<div class="log-entry error">Error: ' + (result.message || 'Annotation failed') + '</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="log-entry error">Error: ' + error.message + '</div>';
            }
        }
        
        async function createAnnotationJob() {
            const corpus_id = document.getElementById('annotation-corpus').value;
            const engine = document.getElementById('annotation-job-engine').value;
            
            if (!corpus_id) {
                alert('Please select a corpus');
                return;
            }
            
            try {
                const response = await fetch(API_BASE + '/annotation/jobs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ corpus_id, engine })
                });
                
                if (response.ok) {
                    addActivityLog('Created annotation job', 'success');
                    loadAnnotationJobs();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.message || 'Failed to create job'));
                }
            } catch (error) {
                console.error('Error creating annotation job:', error);
            }
        }
        
        async function loadValencyPage() {
            await loadCorporaDropdowns();
            await loadLexicons();
            await loadValencyJobs();
        }
        
        async function loadLexicons() {
            try {
                const lexicons = await fetch(API_BASE + '/valency/lexicons').then(r => r.json());
                const tbody = document.getElementById('lexicons-table');
                
                if (lexicons.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="empty-state">No lexicons yet</td></tr>';
                    return;
                }
                
                tbody.innerHTML = lexicons.map(lex => `
                    <tr>
                        <td>${lex.name || lex.id}</td>
                        <td>${lex.language || '--'}</td>
                        <td>${lex.pattern_count || 0}</td>
                        <td>${lex.created_at || '--'}</td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="viewLexicon('${lex.id}')">View</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading lexicons:', error);
            }
        }
        
        async function loadValencyJobs() {
            try {
                const jobs = await fetch(API_BASE + '/valency/jobs').then(r => r.json());
                const tbody = document.getElementById('valency-jobs-table');
                
                if (jobs.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="empty-state">No valency jobs</td></tr>';
                    return;
                }
                
                tbody.innerHTML = jobs.map(job => `
                    <tr>
                        <td>${job.job_id || job.id}</td>
                        <td>${job.corpus_id || '--'}</td>
                        <td><span class="badge badge-${getStatusBadge(job.status)}">${job.status}</span></td>
                        <td>${job.patterns_found || 0}</td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="viewValencyJob('${job.job_id || job.id}')">View</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading valency jobs:', error);
            }
        }
        
        async function extractValency() {
            const corpus_id = document.getElementById('valency-corpus').value;
            const verb = document.getElementById('valency-verb').value;
            
            if (!corpus_id) {
                alert('Please select a corpus');
                return;
            }
            
            try {
                const response = await fetch(API_BASE + '/valency/extract', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ corpus_id, verb_lemma: verb || null })
                });
                
                if (response.ok) {
                    addActivityLog('Started valency extraction', 'success');
                    loadValencyJobs();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.message || 'Failed to start extraction'));
                }
            } catch (error) {
                console.error('Error extracting valency:', error);
            }
        }
        
        async function loadIngestPage() {
            await loadSources();
            await loadIngestJobs();
        }
        
        async function loadSources() {
            try {
                const sources = await fetch(API_BASE + '/ingest/sources').then(r => r.json());
                const tbody = document.getElementById('sources-table');
                
                if (sources.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="empty-state">No sources configured</td></tr>';
                    return;
                }
                
                tbody.innerHTML = sources.map(src => `
                    <tr>
                        <td>${src.name || src.id}</td>
                        <td>${src.description || '--'}</td>
                        <td>${(src.languages || []).join(', ') || '--'}</td>
                        <td><span class="badge badge-${src.enabled ? 'success' : 'secondary'}">${src.enabled ? 'Active' : 'Disabled'}</span></td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="ingestFromSource('${src.id}')">Ingest</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading sources:', error);
            }
        }
        
        async function loadIngestJobs() {
            try {
                const jobs = await fetch(API_BASE + '/ingest/jobs').then(r => r.json());
                const tbody = document.getElementById('ingest-jobs-table');
                
                if (jobs.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No ingest jobs</td></tr>';
                    return;
                }
                
                tbody.innerHTML = jobs.map(job => `
                    <tr>
                        <td>${job.job_id || job.id}</td>
                        <td>${job.source || '--'}</td>
                        <td>${job.language || '--'}</td>
                        <td><span class="badge badge-${getStatusBadge(job.status)}">${job.status}</span></td>
                        <td>${job.texts_processed || 0}</td>
                        <td>
                            ${job.status === 'running' ? `<button class="btn btn-sm btn-danger" onclick="cancelIngestJob('${job.job_id || job.id}')">Cancel</button>` : ''}
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading ingest jobs:', error);
            }
        }
        
        async function createIngestJob() {
            const source = document.getElementById('ingest-source').value;
            const language = document.getElementById('ingest-language').value;
            const max_texts = parseInt(document.getElementById('ingest-max').value) || 10;
            
            try {
                const response = await fetch(API_BASE + '/ingest/jobs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ source, language, max_texts })
                });
                
                if (response.ok) {
                    addActivityLog('Started ingest job from ' + source, 'success');
                    loadIngestJobs();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.message || 'Failed to create job'));
                }
            } catch (error) {
                console.error('Error creating ingest job:', error);
            }
        }
        
        async function loadDiachronicPage() {
            await loadCorporaDropdowns();
            await loadPeriods();
        }
        
        async function loadPeriods() {
            try {
                const periods = await fetch(API_BASE + '/diachronic/periods').then(r => r.json());
                const tbody = document.getElementById('periods-table');
                
                if (periods.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="empty-state">No periods defined</td></tr>';
                    return;
                }
                
                tbody.innerHTML = periods.map(p => `
                    <tr>
                        <td>${p.name || p.id}</td>
                        <td>${p.start_year || '--'}</td>
                        <td>${p.end_year || '--'}</td>
                        <td>${p.description || '--'}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading periods:', error);
            }
        }
        
        async function loadQAPage() {
            await loadCorporaDropdowns();
        }
        
        async function validateContent() {
            const content = document.getElementById('validate-content').value;
            const format = document.getElementById('validate-format').value;
            
            if (!content) {
                alert('Please enter content to validate');
                return;
            }
            
            const resultDiv = document.getElementById('validation-result');
            resultDiv.innerHTML = '<div class="log-entry info">Validating...</div>';
            
            try {
                const response = await fetch(API_BASE + '/qa/validate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content, format })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    const isValid = result.valid || result.is_valid;
                    resultDiv.innerHTML = `
                        <div class="log-entry ${isValid ? 'success' : 'error'}">
                            Validation ${isValid ? 'PASSED' : 'FAILED'}
                        </div>
                        ${(result.errors || []).map(e => `<div class="log-entry error">${e}</div>`).join('')}
                        ${(result.warnings || []).map(w => `<div class="log-entry info">${w}</div>`).join('')}
                    `;
                } else {
                    resultDiv.innerHTML = '<div class="log-entry error">Error: ' + (result.message || 'Validation failed') + '</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="log-entry error">Error: ' + error.message + '</div>';
            }
        }
        
        async function loadSystemPage() {
            try {
                const health = await fetch('/health').then(r => r.json());
                const info = await fetch('/info').then(r => r.json());
                
                document.getElementById('api-version').textContent = info.version || health.version || '--';
                document.getElementById('api-title').textContent = info.title || '--';
                
                const endpointsList = document.getElementById('api-endpoints');
                endpointsList.innerHTML = Object.entries(info.endpoints || {})
                    .map(([name, path]) => `<li style="color: #a0aec0;">${name}: ${path}</li>`)
                    .join('');
                
                document.getElementById('system-api-status').innerHTML = 
                    '<span class="status-indicator running"></span>Running';
                
            } catch (error) {
                console.error('Error loading system info:', error);
                document.getElementById('system-api-status').innerHTML = 
                    '<span class="status-indicator stopped"></span>Error';
            }
        }
        
        async function loadCorporaDropdowns() {
            try {
                const corpora = await fetch(API_BASE + '/corpus/').then(r => r.json());
                const options = corpora.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
                const defaultOption = '<option value="">-- Select corpus --</option>';
                
                ['annotation-corpus', 'valency-corpus', 'diachronic-corpus', 'audit-corpus'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.innerHTML = defaultOption + options;
                });
            } catch (error) {
                console.error('Error loading corpora for dropdowns:', error);
            }
        }
        
        function getStatusBadge(status) {
            switch(status) {
                case 'completed': case 'success': return 'success';
                case 'running': case 'in_progress': return 'info';
                case 'pending': case 'queued': return 'warning';
                case 'failed': case 'error': return 'danger';
                default: return 'secondary';
            }
        }
        
        function showModal(id) {
            document.getElementById(id).classList.add('active');
        }
        
        function hideModal(id) {
            document.getElementById(id).classList.remove('active');
        }
        
        function addActivityLog(message, type = 'info') {
            const log = document.getElementById('activity-log');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + type;
            entry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            log.insertBefore(entry, log.firstChild);
            
            while (log.children.length > 50) {
                log.removeChild(log.lastChild);
            }
        }
        
        function refreshActivity() {
            loadDashboardData();
            addActivityLog('Dashboard refreshed', 'info');
        }
        
        function startAutoRefresh() {
            refreshInterval = setInterval(() => {
                if (currentPage === 'dashboard') {
                    loadDashboardData();
                } else if (currentPage === 'system') {
                    loadSystemPage();
                }
            }, 30000);
        }
        
        function refreshSystemLogs() {
            addActivityLog('System logs refreshed', 'info');
        }
        
        function clearSystemLogs() {
            document.getElementById('system-logs').innerHTML = 
                '<div class="log-entry info"><span class="timestamp">[' + new Date().toLocaleTimeString() + ']</span> Logs cleared</div>';
        }
    </script>
</body>
</html>
